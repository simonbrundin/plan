# ------------------------------------------------------------------
# Local Development Mode
# Runs database and backend in Docker, frontend locally
# ------------------------------------------------------------------

# ------------------------------------------------------------------
# Docker Compose Setup
# ------------------------------------------------------------------

# Ladda backend services (postgres + hasura) från dedikerad compose-fil
docker_compose('./docker-compose.backend.yml')

# ------------------------------------------------------------------
# PostgreSQL Database
# ------------------------------------------------------------------

dc_resource(
  'postgres',
  labels=['Database'],
)

# ------------------------------------------------------------------
# Hasura GraphQL Engine
# ------------------------------------------------------------------

dc_resource(
  'hasura',
  labels=['Backend'],
  links=['http://localhost:8080/console'],
)

# ------------------------------------------------------------------
# Frontend (Nuxt Dev Server) - körs lokalt
# ------------------------------------------------------------------

local_resource(
  'Nuxt Dev Server',
  serve_cmd='cd ../frontend && bun run dev',
  links=['http://localhost:3000'],
  labels=['Frontend'],
  resource_deps=['postgres', 'hasura'],  # Vänta på backend
)

# ------------------------------------------------------------------
# Drizzle Studio
# ------------------------------------------------------------------

local_resource(
  'Drizzle Studio',
  serve_cmd='cd ../frontend && bun run db:studio',
  links=['https://local.drizzle.studio'],
  labels=['Database'],
  resource_deps=['postgres'],  # Vänta på PostgreSQL
)
