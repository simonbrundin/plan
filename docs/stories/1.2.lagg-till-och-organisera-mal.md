# <!-- Powered by BMAD™ Core -->

## Status
Ready for Review

## Story
**As a** användare,
**I want** kunna lägga till nya mål och organisera in dem i trädet på ett enkelt sätt, helst både via text och ljud,
**so that** jag enkelt kan expandera min målstruktur utan tekniska hinder.

## Acceptance Criteria
1. Systemet ska tillåta användaren att lägga till nya mål via ett enkelt formulär
2. Systemet ska stödja röstinmatning för att lägga till mål
3. Nya mål ska kunna organiseras i befintligt träd med drag-och-släpp
4. Systemet ska validera inmatning och ge användarvänliga felmeddelanden

## Tasks / Subtasks
- [x] Task 1: Skapa formulär för att lägga till nya mål (AC: 1)
  - [x] Subtask 1.1: Designa användargränssnitt för målformulär
  - [x] Subtask 1.2: Implementera validering av formulärfält
- [x] Task 2: Implementera röstinmatning för målskapande (AC: 2)
  - [x] Subtask 2.1: Integrera Web Speech API för röstinmatning
  - [x] Subtask 2.2: Hantera röstinmatningsfel och timeout
- [x] Task 3: Implementera drag-och-släpp för organisation (AC: 3)
  - [x] Subtask 3.1: Integrera DnD-kit för drag-och-släpp-funktionalitet
  - [x] Subtask 3.2: Uppdatera målrelationer vid flyttning
- [x] Task 4: Implementera validering och felhantering (AC: 4)
  - [x] Subtask 4.1: Skapa valideringsregler för måldata
  - [x] Subtask 4.2: Visa användarvänliga felmeddelanden

## Dev Notes
### Previous Story Insights
- Mål har följande struktur: id, title, image_url, icon_url, is_completed, parent_ids, child_ids
- API-endpoints finns på /api/goals med GET, POST och PUT-operationer
- Redux state management är implementerat med goalsSlice
- React-komponenter finns i components/goals/

### Data Models
- **Goal-entitet**: Samma struktur som i föregående story

### API Specifications
- **POST /api/goals**: Skapar nytt mål
- **PUT /api/goals/{id}**: Uppdaterar befintligt mål

### Component Specifications
- **Frontend**: React-komponenter i components/goals/
- **State Management**: Redux Toolkit med goalsSlice

### File Locations
- **Frontend Components**: components/goals/
- **Redux**: lib/redux/
- **API Routes**: app/api/goals/

### Testing Requirements
- Enhetstester för nya komponenter
- Integrationstester för API-endpoints
- Användbarhetstest för drag-och-släpp-funktion

### Technical Constraints
- Använd befintlig Goal-entitet och API-struktur
- Följ samma kodningsstandard som i föregående story

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-08-19 | 1.0 | Initial story draft | Bob (Scrum Master) |
| 2025-08-19 | 1.1 | Slutfört Task 1: Skapa formulär för att lägga till nya mål | Developer Agent |
| 2025-08-19 | 1.2 | Slutfört Task 2: Implementera röstinmatning för målskapande | Developer Agent |
| 2025-08-19 | 1.3 | Slutfört Task 3: Implementera drag-och-släpp för organisation | Developer Agent |
| 2025-08-19 | 1.4 | Slutfört Task 4: Implementera validering och felhantering | Developer Agent |

## Dev Agent Record
### Agent Model Used
Developer Agent

### Debug Log References
- Task 1.1: Designa användargränssnitt för målformulär
- Task 1.2: Implementera validering av formulärfält
- Task 2.1: Integrera Web Speech API för röstinmatning
- Task 2.2: Hantera röstinmatningsfel och timeout
- Task 3.1: Integrera DnD-kit för drag-och-släpp-funktionalitet
- Task 3.2: Uppdatera målrelationer vid flyttning
- Task 4.1: Skapa valideringsregler för måldata
- Task 4.2: Visa användarvänliga felmeddelanden

### Completion Notes List
- [x] Skapat AddGoalForm-komponent med fält för titel, bild-URL och ikon-URL
- [x] Implementerat validering för obligatorisk titel
- [x] Lagt till formulär i GoalTree-komponenten
- [x] Implementerat responsiv design med Tailwind CSS
- [x] Lagt till submit-knapp med loading-state
- [x] Skapat VoiceInput-komponent som använder Web Speech API
- [x] Implementerat röstinmatning för måltitlar
- [x] Lagt till felhantering för röstinmatning
- [x] Integrerat röstinmatning i AddGoalForm
- [x] Skapat DnDGoalNode-komponent med drag-och-släpp-stöd
- [x] Skapat DnDGoalTree-komponent med full drag-och-släpp-funktionalitet
- [x] Implementerat ordning av mål med drag-och-släpp
- [x] Lagt till visuella indikatorer för drag-och-släpp
- [x] Skapat valideringsfunktioner för måldata
- [x] Implementerat validering av titel, bild-URL och ikon-URL
- [x] Lagt till användarvänliga felmeddelanden i formuläret
- [x] Integrerat validering i API-endpoints

### File List
- components/goals/AddGoalForm.tsx
- components/goals/GoalTree.tsx
- components/goals/VoiceInput.tsx
- components/goals/DnDGoalNode.tsx
- components/goals/DnDGoalTree.tsx
- components/goals/validators.ts
- app/api/goals/route.ts
- components/goals/index.ts

## QA Results