# <!-- Powered by BMAD™ Core -->

## Status

Ready for Review

## Story

**As a** användare, **I want** kunna strukturera upp mitt liv och dess mål i en
trädstruktur där varje mål kan ha både flera föräldrar och flera barn i oändligt
många steg, **so that** jag kan organisera och visualisera mina mål på ett
hierarkiskt sätt.

## Acceptance Criteria

1. Systemet ska kunna hantera mål med flera föräldrar och flera barn
2. Trädstrukturen ska stödja oändligt många nivåer av hierarki
3. Användaren ska kunna se den hierarkiska strukturen visuellt

## Tasks / Subtasks

- [x] Task 1: Designa datamodell för trädstruktur (AC: 1)
  - [x] Subtask 1.1: Definiera Goal-entitet med parent_ids och child_ids
  - [x] Subtask 1.2: Designa databasschema för PostgreSQL relationer
- [x] Task 2: Implementera backend API-endpoints (AC: 1, 2)
  - [x] Subtask 2.1: Skapa GET /api/goals endpoint
  - [x] Subtask 2.2: Skapa POST /api/goals endpoint
  - [x] Subtask 2.3: Skapa PUT /api/goals/{id} endpoint för att hantera
        relationer
- [x] Task 3: Skapa frontend React-komponenter (AC: 3)
  - [x] Subtask 3.1: Implementera GoalNode-komponent för individuella mål
  - [x] Subtask 3.2: Implementera GoalTree-komponent för trädvisualisering
- [x] Task 4: Implementera state management med Redux Toolkit (AC: 1, 2)
  - [x] Subtask 4.1: Skapa Redux store för goals state
  - [x] Subtask 4.2: Implementera actions och reducers för CRUD operationer
- [x] Task 5: Enhetstesta alla komponenter (AC: 1, 2, 3)
  - [x] Subtask 5.1: Skapa enhetstester för Goal-entitet
  - [x] Subtask 5.2: Skapa enhetstester för API-endpoints
  - [x] Subtask 5.3: Skapa enhetstester för React-komponenter

## Dev Notes

### Previous Story Insights

Inga tidigare stories existerar för detta projekt.

### Data Models

- **Goal-entitet**: Varje mål ska inkludera `id`, `title`, `image_url`,
  `icon_url`, `is_completed`, `parent_ids` (array), `child_ids` (array) [Source:
  docs/architecture.md#datastruktur]
- **Relationer**: Ett mål kan ha flera föräldrar och barn via `parent_ids` och
  `child_ids` arrays [Source: docs/architecture.md#datastruktur]

### API Specifications

- **GET /api/goals**: Hämtar alla mål [Source: docs/architecture.md#api-design]
- **GET /api/goals/{id}**: Hämtar specifikt mål och dess direkta föräldrar och
  barn [Source: docs/architecture.md#api-design]
- **POST /api/goals**: Skapar nytt mål [Source: docs/architecture.md#api-design]
- **PUT /api/goals/{id}**: Uppdaterar befintligt mål, inklusive att lägga
  till/ta bort förälder- och barnrelationer [Source:
  docs/architecture.md#api-design]

### Component Specifications

- **Frontend**: React-komponenter för trädvisualisering [Source:
  docs/architecture.md#frontend]
- **State Management**: Redux Toolkit för att hantera komplex trädstruktur
  [Source: docs/architecture.md#state-management]

### File Locations

- **Backend**: Node.js/Express.js applikation med PostgreSQL [Source:
  docs/architecture.md#backend]
- **Frontend**: React SPA i samma monolit [Source:
  docs/architecture.md#frontend]
- **Databas**: PostgreSQL för att hantera komplexa relationer [Source:
  docs/architecture.md#databas]

### Testing Requirements

Ingen specifik teststrategi definierad i arkitekturdokumenten.

### Technical Constraints

- **Monolitisk arkitektur**: Backend och frontend i samma applikation [Source:
  docs/architecture.md#övergripande-arkitektur]
- **JWT-autentisering**: För skydd av API-endpoints [Source:
  docs/architecture.md#säkerhet]

## Change Log

| Date       | Version | Description                                                      | Author             |
| ---------- | ------- | ---------------------------------------------------------------- | ------------------ |
| 2025-08-19 | 1.0     | Initial story draft                                              | Bob (Scrum Master) |
| 2025-08-19 | 1.1     | Slutfört Task 1: Designa datamodell för trädstruktur             | Developer Agent    |
| 2025-08-19 | 1.2     | Slutfört Task 2: Implementera backend API-endpoints              | Developer Agent    |
| 2025-08-19 | 1.3     | Slutfört Task 3: Skapa frontend React-komponenter                | Developer Agent    |
| 2025-08-19 | 1.4     | Slutfört Task 4: Implementera state management med Redux Toolkit | Developer Agent    |
| 2025-08-19 | 1.5     | Slutfört Task 5: Enhetstesta alla komponenter                    | Developer Agent    |

## Dev Agent Record

### Agent Model Used

Developer Agent

### Debug Log References

- Task 1.1: Definierade Goal-entitet med parent_ids och child_ids
- Task 1.2: Designade databasschema för PostgreSQL relationer
- Task 2.1: Implementerade GET /api/goals endpoint
- Task 2.2: Implementerade POST /api/goals endpoint
- Task 2.3: Implementerade PUT /api/goals/{id} endpoint
- Task 3.1: Implementerade GoalNode-komponent för individuella mål
- Task 3.2: Implementerade GoalTree-komponent för trädvisualisering
- Task 4.1: Skapade Redux store för goals state
- Task 4.2: Implementerade actions och reducers för CRUD operationer
- Task 5.1: Skapade enhetstester för Goal-entitet
- Task 5.2: Skapade enhetstester för API-endpoints
- Task 5.3: Skapade enhetstester för React-komponenter

### Completion Notes List

- [x] Definierat Goal-entitet med nödvändiga fält inklusive parent_ids och
      child_ids
- [x] Designat databasschema som stödjer många-till-många-relationer mellan mål
- [x] Skapat tabellstruktur för goals och goal_relations
- [x] Lagt till index för bättre prestanda vid uppslag
- [x] Implementerat GET endpoint för att hämta alla mål
- [x] Implementerat POST endpoint för att skapa nya mål
- [x] Implementerat PUT endpoint för att uppdatera befintliga mål och deras
      relationer
- [x] Lagt till felhantering och validering i API-endpoints
- [x] Skapat GoalNode-komponent för att visa individuella mål med checkbox,
      titel och åtgärder
- [x] Skapat GoalTree-komponent för att visa hela trädstrukturen av mål
- [x] Implementerat rekursiv rendering av mål och deras undermål
- [x] Lagt till funktioner för att skapa, redigera och ta bort mål
- [x] Installerat Redux Toolkit och React-Redux
- [x] Skapat goalsSlice med async thunks för alla CRUD-operationer
- [x] Skapat Redux store med konfiguration
- [x] Implementerat actions och reducers för state management
- [x] Lagt till felhantering och loading states
- [x] Skapat enhetstester för Goal-entitet
- [x] Skapat enhetstester för API-endpoints
- [x] Skapat enhetstester för React-komponenter
- [x] Konfigurerat testmiljö med Jest och Testing Library
- [x] Lagt till testskript i package.json

### File List

- datamodell/goal-entity.ts
- datamodell/database-schema.sql
- app/api/goals/route.ts
- components/goals/GoalNode.tsx
- components/goals/GoalTree.tsx
- components/goals/index.ts
- lib/redux/goalsSlice.ts
- lib/redux/store.ts
- lib/redux/index.ts
- **tests**/datamodell/goal-entity.test.ts
- **tests**/lib/redux/goalsSlice.test.ts
- **tests**/components/goals/GoalNode.test.tsx
- **tests**/components/goals/GoalTree.test.tsx
- **tests**/api/goals/api.test.ts
- **tests**/setup.ts
- jest.config.js

## QA Results

